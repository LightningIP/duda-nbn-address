define(["exports","../../../../vue/dist/vue.runtime.esm-bundler.js","./VImg.css.js","../VResponsive/VResponsive.js","../../composables/color.js","../../composables/component.js","../../composables/rounded.js","../../composables/transition.js","../../directives/intersect/index.js","../../util/index.js","../../util/propsFactory.js","../../util/defineComponent.js","../../../../@vue/reactivity/dist/reactivity.esm-bundler.js","../../util/getCurrentInstance.js","../../../../@vue/runtime-core/dist/runtime-core.esm-bundler.js","../../util/globals.js","../../../../@vue/runtime-dom/dist/runtime-dom.esm-bundler.js","../../util/useRender.js","../../util/helpers.js"],function(b,p,C,h,U,F,j,u,W,B,O,x,s,E,t,D,H,$,q){"use strict";const N=O.propsFactory({absolute:Boolean,alt:String,cover:Boolean,color:String,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...h.makeVResponsiveProps(),...F.makeComponentProps(),...j.makeRoundedProps(),...u.makeTransitionProps()},"VImg"),A=x.genericComponent()({name:"VImg",directives:{intersect:W.Intersect},props:N(),emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(e,L){let{emit:m,slots:c}=L;const{backgroundColorClasses:G,backgroundColorStyles:J}=U.useBackgroundColor(s.toRef(e,"color")),{roundedClasses:K}=j.useRounded(e),f=E.getCurrentInstance("VImg"),R=s.shallowRef(""),i=s.ref(),r=s.shallowRef(e.eager?"loading":"idle"),g=s.shallowRef(),S=s.shallowRef(),n=t.computed(()=>e.src&&typeof e.src=="object"?{src:e.src.src,srcset:e.srcset||e.src.srcset,lazySrc:e.lazySrc||e.src.lazySrc,aspect:Number(e.aspectRatio||e.src.aspect||0)}:{src:e.src,srcset:e.srcset,lazySrc:e.lazySrc,aspect:Number(e.aspectRatio||0)}),d=t.computed(()=>n.value.aspect||g.value/S.value||0);t.watch(()=>e.src,()=>{y(r.value!=="idle")}),t.watch(d,(a,l)=>{!a&&l&&i.value&&v(i.value)}),t.onBeforeMount(()=>y());function y(a){if(!(e.eager&&a)&&!(D.SUPPORTS_INTERSECTION&&!a&&!e.eager)){if(r.value="loading",n.value.lazySrc){const l=new Image;l.src=n.value.lazySrc,v(l,null)}n.value.src&&t.nextTick(()=>{var l;m("loadstart",((l=i.value)==null?void 0:l.currentSrc)||n.value.src),setTimeout(()=>{var o;if(!f.isUnmounted)if((o=i.value)!=null&&o.complete){if(i.value.naturalWidth||I(),r.value==="error")return;d.value||v(i.value,null),r.value==="loading"&&w()}else d.value||v(i.value),z()})})}}function w(){var a;f.isUnmounted||(z(),v(i.value),r.value="loaded",m("load",((a=i.value)==null?void 0:a.currentSrc)||n.value.src))}function I(){var a;f.isUnmounted||(r.value="error",m("error",((a=i.value)==null?void 0:a.currentSrc)||n.value.src))}function z(){const a=i.value;a&&(R.value=a.currentSrc||a.src)}let V=-1;t.onBeforeUnmount(()=>{clearTimeout(V)});function v(a){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const o=()=>{if(clearTimeout(V),f.isUnmounted)return;const{naturalHeight:k,naturalWidth:M}=a;k||M?(g.value=M,S.value=k):!a.complete&&r.value==="loading"&&l!=null?V=window.setTimeout(o,l):(a.currentSrc.endsWith(".svg")||a.currentSrc.startsWith("data:image/svg+xml"))&&(g.value=1,S.value=1)};o()}const T=t.computed(()=>({"v-img__img--cover":e.cover,"v-img__img--contain":!e.cover})),Q=()=>{var o;if(!n.value.src||r.value==="idle")return null;const a=t.createVNode("img",{class:["v-img__img",T.value],style:{objectPosition:e.position},src:n.value.src,srcset:n.value.srcset,alt:e.alt,crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy,draggable:e.draggable,sizes:e.sizes,ref:i,onLoad:w,onError:I},null),l=(o=c.sources)==null?void 0:o.call(c);return t.createVNode(u.MaybeTransition,{transition:e.transition,appear:!0},{default:()=>[t.withDirectives(l?t.createVNode("picture",{class:"v-img__picture"},[l,a]):a,[[H.vShow,r.value==="loaded"]])]})},X=()=>t.createVNode(u.MaybeTransition,{transition:e.transition},{default:()=>[n.value.lazySrc&&r.value!=="loaded"&&t.createVNode("img",{class:["v-img__img","v-img__img--preload",T.value],style:{objectPosition:e.position},src:n.value.lazySrc,alt:e.alt,crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy,draggable:e.draggable},null)]}),Y=()=>c.placeholder?t.createVNode(u.MaybeTransition,{transition:e.transition,appear:!0},{default:()=>[(r.value==="loading"||r.value==="error"&&!c.error)&&t.createVNode("div",{class:"v-img__placeholder"},[c.placeholder()])]}):null,Z=()=>c.error?t.createVNode(u.MaybeTransition,{transition:e.transition,appear:!0},{default:()=>[r.value==="error"&&t.createVNode("div",{class:"v-img__error"},[c.error()])]}):null,_=()=>e.gradient?t.createVNode("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${e.gradient})`}},null):null,P=s.shallowRef(!1);{const a=t.watch(d,l=>{l&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{P.value=!0})}),a())})}return $.useRender(()=>{const a=h.VResponsive.filterProps(e);return t.withDirectives(t.createVNode(h.VResponsive,t.mergeProps({class:["v-img",{"v-img--absolute":e.absolute,"v-img--booting":!P.value},G.value,K.value,e.class],style:[{width:q.convertToUnit(e.width==="auto"?g.value:e.width)},J.value,e.style]},a,{aspectRatio:d.value,"aria-label":e.alt,role:e.alt?"img":void 0}),{additional:()=>t.createVNode(t.Fragment,null,[t.createVNode(Q,null,null),t.createVNode(X,null,null),t.createVNode(_,null,null),t.createVNode(Y,null,null),t.createVNode(Z,null,null)]),default:c.default}),[[t.resolveDirective("intersect"),{handler:y,options:e.options},null,{once:!0}]])}),{currentSrc:R,image:i,state:r,naturalWidth:g,naturalHeight:S}}});b.VImg=A,b.makeVImgProps=N,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
